"use strict";(()=>{var e={};e.id=540,e.ids=[540],e.modules={145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},7174:e=>{e.exports=import("@anthropic-ai/sdk")},8043:(e,t,n)=>{n.a(e,async(e,a)=>{try{n.r(t),n.d(t,{config:()=>d,default:()=>c,routeModule:()=>p});var r=n(1802),s=n(7153),o=n(6249),i=n(3030),l=e([i]);i=(l.then?(await l)():l)[0];let c=(0,o.l)(i,"default"),d=(0,o.l)(i,"config"),p=new r.PagesAPIRouteModule({definition:{kind:s.x.PAGES_API,page:"/api/anthropic",pathname:"/api/anthropic",bundlePath:"",filename:""},userland:i});a()}catch(e){a(e)}})},3030:(e,t,n)=>{n.a(e,async(e,a)=>{try{n.r(t),n.d(t,{default:()=>handler});var r=n(7174),s=e([r]);async function handler(e,t){let{messages:n,apiKey:a,model:s,stream:o}=e.body,i=new r.Anthropic({apiKey:a}),l=n.find(e=>"system"===e.role),c=n.filter(e=>"system"!==e.role);c=c.filter(e=>""!==e.content);let d=[],p=null,m="";for(c.forEach((e,t)=>{e.role===p?m+="\n"+e.content:(null!==p&&d.push({role:p,content:m}),p=e.role,m=e.content),t===c.length-1&&d.push({role:p,content:m})});d.length>0&&"user"!==d[0].role;)d.shift();if(c=d,o)t.writeHead(200,{"Content-Type":"text/event-stream","Cache-Control":"no-cache",Connection:"keep-alive"}),await i.messages.stream({system:l?.content,messages:c,model:s,max_tokens:200}).on("text",e=>{t.write(`data: ${JSON.stringify({type:"content_block_delta",text:e})}

`)}).on("error",e=>{t.write(`data: ${JSON.stringify({type:"error",error:e})}

`)}).on("end",()=>{t.write(`data: ${JSON.stringify({type:"message_stop"})}

`),t.end()});else{let e=await i.messages.create({system:l?.content,messages:c,model:s,max_tokens:200});t.status(200).json({message:e.content})}}r=(s.then?(await s)():s)[0],a()}catch(e){a(e)}})}};var t=require("../../webpack-api-runtime.js");t.C(e);var __webpack_exec__=e=>t(t.s=e),n=t.X(0,[222],()=>__webpack_exec__(8043));module.exports=n})();