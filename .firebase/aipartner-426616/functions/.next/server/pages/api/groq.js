"use strict";(()=>{var e={};e.id=121,e.ids=[121],e.modules={145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},6219:e=>{e.exports=import("groq-sdk")},4808:(e,t,a)=>{a.a(e,async(e,o)=>{try{a.r(t),a.d(t,{config:()=>d,default:()=>i,routeModule:()=>u});var r=a(1802),n=a(7153),s=a(6249),l=a(5851),c=e([l]);l=(c.then?(await c)():c)[0];let i=(0,s.l)(l,"default"),d=(0,s.l)(l,"config"),u=new r.PagesAPIRouteModule({definition:{kind:n.x.PAGES_API,page:"/api/groq",pathname:"/api/groq",bundlePath:"",filename:""},userland:l});o()}catch(e){o(e)}})},5851:(e,t,a)=>{a.a(e,async(e,o)=>{try{a.r(t),a.d(t,{default:()=>handler});var r=a(6219),n=e([r]);async function handler(e,t){let{messages:a,apiKey:o,model:n,stream:s}=e.body;console.log("Request body:",e.body);let l=new r.default({apiKey:o}),c=a.find(e=>"system"===e.role),i=a.filter(e=>"system"!==e.role);i=i.filter(e=>""!==e.content);let d=[],u=null,f="";if(i.forEach((e,t)=>{e.role===u?f+="\n"+e.content:(null!==u&&d.push({role:u,content:f}),u=e.role,f=e.content),t===i.length-1&&d.push({role:u,content:f})}),i=d,s){t.writeHead(200,{"Content-Type":"text/event-stream","Cache-Control":"no-cache",Connection:"keep-alive"});let e=await l.chat.completions.create({messages:[{role:"system",content:c?.content},...i],model:n,max_tokens:200,stream:!0}).catch(async e=>{if(e instanceof r.default.APIError)t.write(`data: ${JSON.stringify({type:"error",error:e})}

`),t.end();else throw e});if(e){let a=e.getReader(),o=new TextDecoder("utf-8");for(;;){let{done:e,value:r}=await a.read();if(e){t.write(`data: ${JSON.stringify({type:"message_stop"})}

`),t.end();break}let n=o.decode(r,{stream:!0});console.log("chunk:",n),t.write(`data: ${JSON.stringify({type:"content_block_delta",text:n})}

`)}}}else{let e=await l.chat.completions.create({messages:[{role:"system",content:c?.content},...i],model:n,max_tokens:200}).catch(async e=>{if(e instanceof r.default.APIError)console.error("Groq API Error:",e),e.status&&t.status(e.status).json({error:e});else throw e});if(e){let a=e.choices[0].message.content;t.status(200).json({message:a})}}}r=(n.then?(await n)():n)[0],o()}catch(e){o(e)}})}};var t=require("../../webpack-api-runtime.js");t.C(e);var __webpack_exec__=e=>t(t.s=e),a=t.X(0,[222],()=>__webpack_exec__(4808));module.exports=a})();